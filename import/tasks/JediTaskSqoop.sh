#!/bin/bash

echo "  *******************************  importing JediTasks table  *******************************"
echo " between $1 and $2 "

sqoop import -D oraoop.disabled=true --direct --connect "jdbc:oracle:thin:@//ADCR1-ADG-S.cern.ch:10121/ADCR.cern.ch" \
    --table ATLAS_PANDA.JEDI_TASKS --username ATLAS_PANDAMON_READER -P \
    --where "MODIFICATIONTIME between TO_DATE('$1','YYYY-MM-DD HH24:MI:SS') and TO_DATE('$2','YYYY-MM-DD HH24:MI:SS')" \
    --split-by JEDITASKID --as-avrodatafile --target-dir /atlas/analytics/jedi/tasks/$3 \
    --columns JEDITASKID,TASKNAME,STATUS,USERNAME,REQID,OLDSTATUS,CLOUD,SITE,PRODSOURCELABEL,WORKINGGROUP,VO,CORECOUNT,TASKTYPE,PROCESSINGTYPE,TASKPRIORITY,CURRENTPRIORITY,ARCHITECTURE,TRANSUSES,TRANSHOME,TRANSPATH,LOCKEDBY,TERMCONDITION,SPLITRULE,WALLTIME,WALLTIMEUNIT,OUTDISKCOUNT,OUTDISKUNIT,WORKDISKCOUNT,WORKDISKUNIT,RAMCOUNT,RAMUNIT,IOINTENSITY,IOINTENSITYUNIT,WORKQUEUE_ID,PROGRESS,FAILURERATE,ERRORDIALOG,COUNTRYGROUP,PARENT_TID,EVENTSERVICE,TICKETID,TICKETSYSTEMTYPE,SUPERSTATUS,CAMPAIGN,MERGERAMCOUNT,MERGERAMUNIT,MERGEWALLTIME,MERGEWALLTIMEUNIT,NUMTHROTTLED,MERGECORECOUNT,GOAL,CPUTIME,CPUTIMEUNIT,CPUEFFICIENCY,BASEWALLTIME,AMIFLAG_OLD,AMIFLAG,NUCLEUS,BASERAMCOUNT,LOCKEDTIME,STATECHANGETIME,THROTTLEDTIME,ASSESSMENTTIME,CREATIONDATE,MODIFICATIONTIME,STARTTIME,ENDTIME,FROZENTIME \
    --map-column-java JEDITASKID=Long,TASKNAME=String,STATUS=String,USERNAME=String,REQID=Long,OLDSTATUS=String,CLOUD=String,SITE=String,PRODSOURCELABEL=String,WORKINGGROUP=String,VO=String,CORECOUNT=Long,TASKTYPE=String,PROCESSINGTYPE=String,TASKPRIORITY=Long,CURRENTPRIORITY=Long,ARCHITECTURE=String,TRANSUSES=String,TRANSHOME=String,TRANSPATH=String,LOCKEDBY=String,TERMCONDITION=String,SPLITRULE=String,WALLTIME=Long,WALLTIMEUNIT=String,OUTDISKCOUNT=Long,OUTDISKUNIT=String,WORKDISKCOUNT=Long,WORKDISKUNIT=String,RAMCOUNT=Long,RAMUNIT=String,IOINTENSITY=Long,IOINTENSITYUNIT=String,WORKQUEUE_ID=Integer,PROGRESS=Integer,FAILURERATE=Integer,ERRORDIALOG=String,COUNTRYGROUP=String,PARENT_TID=Long,EVENTSERVICE=Integer,TICKETID=String,TICKETSYSTEMTYPE=String,SUPERSTATUS=String,CAMPAIGN=String,MERGERAMCOUNT=Long,MERGERAMUNIT=String,MERGEWALLTIME=Long,MERGEWALLTIMEUNIT=String,NUMTHROTTLED=Integer,MERGECORECOUNT=Long,GOAL=Integer,CPUTIME=Long,CPUTIMEUNIT=String,CPUEFFICIENCY=Integer,BASEWALLTIME=Long,AMIFLAG_OLD=String,AMIFLAG=Integer,NUCLEUS=String,BASERAMCOUNT=Long

echo "DONE"


#JEDITASKID, TASKNAME, STATUS, USERNAME, REQID, OLDSTATUS, CLOUD, SITE, PRODSOURCELABEL, WORKINGGROUP, VO, CORECOUNT, TASKTYPE, PROCESSINGTYPE, TASKPRIORITY, CURRENTPRIORITY, ARCHITECTURE, TRANSUSES, TRANSHOME, TRANSPATH, LOCKEDBY, TERMCONDITION, SPLITRULE, WALLTIME, WALLTIMEUNIT, OUTDISKCOUNT, OUTDISKUNIT, WORKDISKCOUNT, WORKDISKUNIT, RAMCOUNT, RAMUNIT, IOINTENSITY, IOINTENSITYUNIT, WORKQUEUE_ID, PROGRESS, FAILURERATE, ERRORDIALOG, COUNTRYGROUP, PARENT_TID, EVENTSERVICE, TICKETID, TICKETSYSTEMTYPE, SUPERSTATUS, CAMPAIGN, MERGERAMCOUNT, MERGERAMUNIT, MERGEWALLTIME, MERGEWALLTIMEUNIT, NUMTHROTTLED, MERGECORECOUNT, GOAL, CPUTIME, CPUTIMEUNIT, CPUEFFICIENCY, BASEWALLTIME, AMIFLAG_OLD, AMIFLAG, NUCLEUS, BASERAMCOUNT, LOCKEDTIME,STATECHANGETIME,THROTTLEDTIME,ASSESSMENTTIME,CREATIONDATE,MODIFICATIONTIME,STARTTIME,ENDTIME,FROZENTIME
